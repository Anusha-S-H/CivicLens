from pathlib import Path
import pandas as pd

DATA_DIR = Path(__file__).resolve().parent.parent / "data"

# Load data
df = pd.read_csv(DATA_DIR / "district_vulnerability_data.csv")

# Get district list
districts = sorted(df["district"].unique())

# Ask user to select district
print("\nSelect a District:\n")
for i, d in enumerate(districts):
    print(f"{i+1}. {d}")

choice = int(input("\nEnter district number: ")) - 1
district = districts[choice]

# Extract row
row = df[df["district"] == district].iloc[0]

eco = row["economic_dependency"]
edu = row["education_stability"]
health = row["health_dependency"]
vol = row["volatility"]

# Vulnerability score
vulnerability_score = (
    0.3 * eco +
    0.25 * health +
    0.25 * vol +
    0.2 * (1 - edu)
)

# Classification
if vulnerability_score >= 0.65:
    level = "HIGH"
elif vulnerability_score >= 0.45:
    level = "MODERATE"
else:
    level = "LOW"

# Drivers
drivers = []
if eco > 0.65:
    drivers.append("High economic dependency")
if edu < 0.45:
    drivers.append("Low education stability")
if health > 0.65:
    drivers.append("High health dependency")
if vol > 0.60:
    drivers.append("High social volatility")

# -------- OUTPUT (ONLY SELECTED DISTRICT) --------
print("\n" + "=" * 60)
print(f"DISTRICT VULNERABILITY PROFILE: {district}")
print("=" * 60)

print(f"\nVulnerability Score : {vulnerability_score:.2f}")
print(f"Vulnerability Level : {level}")

print("\nKey Risk Drivers:")
if drivers:
    for d in drivers:
        print(f"- {d}")
else:
    print("- No major vulnerability drivers detected")

print("\nInterpretation:")
if level == "HIGH":
    print("High social vulnerability. Preventive intervention is strongly recommended.")
elif level == "MODERATE":
    print("Moderate vulnerability. Continuous monitoring is advised.")
else:
    print("Low vulnerability. Social conditions are relatively stable.")

print("\nNote:")
print("Values are domain-informed synthetic indicators for framework validation.")

print("=" * 60)
